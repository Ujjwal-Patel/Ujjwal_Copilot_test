<div class="task-management-container">
  <h2>Task Management</h2>
  
  <!-- Task Form -->
  <div class="form-container">
    <h3>{{ isEditMode ? 'Edit Task' : 'Add New Task' }}</h3>
    <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="taskName">Task Name <span class="required">*</span></label>
        <input 
          type="text" 
          id="taskName" 
          formControlName="taskName" 
          maxlength="20"
          class="form-control"
          [class.invalid]="taskForm.get('taskName')?.invalid && taskForm.get('taskName')?.touched"
        />
        <div class="error-message" *ngIf="taskForm.get('taskName')?.invalid && taskForm.get('taskName')?.touched">
          <span *ngIf="taskForm.get('taskName')?.errors?.['required']">Task name is required</span>
          <span *ngIf="taskForm.get('taskName')?.errors?.['maxlength']">Maximum 20 characters allowed</span>
        </div>
      </div>

      <div class="form-group">
        <label for="taskDescription">Task Description <span class="required">*</span></label>
        <input 
          type="text" 
          id="taskDescription" 
          formControlName="taskDescription" 
          maxlength="50"
          class="form-control"
          [class.invalid]="taskForm.get('taskDescription')?.invalid && taskForm.get('taskDescription')?.touched"
        />
        <div class="error-message" *ngIf="taskForm.get('taskDescription')?.invalid && taskForm.get('taskDescription')?.touched">
          <span *ngIf="taskForm.get('taskDescription')?.errors?.['required']">Task description is required</span>
          <span *ngIf="taskForm.get('taskDescription')?.errors?.['maxlength']">Maximum 50 characters allowed</span>
        </div>
      </div>

      <div class="form-group">
        <label for="taskExpiryDate">Task Expiry Date <span class="required">*</span></label>
        <input 
          type="date" 
          id="taskExpiryDate" 
          formControlName="taskExpiryDate" 
          class="form-control"
          [class.invalid]="taskForm.get('taskExpiryDate')?.invalid && taskForm.get('taskExpiryDate')?.touched"
        />
        <div class="error-message" *ngIf="taskForm.get('taskExpiryDate')?.invalid && taskForm.get('taskExpiryDate')?.touched">
          <span *ngIf="taskForm.get('taskExpiryDate')?.errors?.['required']">Expiry date is required</span>
        </div>
      </div>

      <div class="form-group">
        <label for="priority">Priority <span class="required">*</span></label>
        <select 
          id="priority" 
          formControlName="priority" 
          class="form-control"
          [class.invalid]="taskForm.get('priority')?.invalid && taskForm.get('priority')?.touched"
        >
          <option value="" disabled selected>Select Priority</option>
          <option *ngFor="let priority of priorities" [value]="priority">{{ priority | titlecase }}</option>
        </select>
        <div class="error-message" *ngIf="taskForm.get('priority')?.invalid && taskForm.get('priority')?.touched">
          <span *ngIf="taskForm.get('priority')?.errors?.['required']">Priority is required</span>
        </div>
      </div>

      <div class="form-group">
        <label for="status">Task Status <span class="required">*</span></label>
        <select 
          id="status" 
          formControlName="status" 
          class="form-control"
          [class.invalid]="taskForm.get('status')?.invalid && taskForm.get('status')?.touched"
        >
          <option value="" disabled selected>Select Status</option>
          <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
        </select>
        <div class="error-message" *ngIf="taskForm.get('status')?.invalid && taskForm.get('status')?.touched">
          <span *ngIf="taskForm.get('status')?.errors?.['required']">Status is required</span>
        </div>
      </div>

      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea 
          id="notes" 
          formControlName="notes" 
          maxlength="500"
          rows="4"
          class="form-control"
          [class.invalid]="taskForm.get('notes')?.invalid && taskForm.get('notes')?.touched"
        ></textarea>
        <div class="error-message" *ngIf="taskForm.get('notes')?.invalid && taskForm.get('notes')?.touched">
          <span *ngIf="taskForm.get('notes')?.errors?.['maxlength']">Maximum 500 characters allowed</span>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="taskForm.invalid" class="btn btn-primary">
          {{ isEditMode ? 'Update Task' : 'Add Task' }}
        </button>
        <button type="button" (click)="resetForm()" class="btn btn-secondary">
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Tasks Table -->
  <div class="table-container">
    <h3>Tasks List</h3>
    <table class="tasks-table" *ngIf="tasks.length > 0">
      <thead>
        <tr>
          <th>Task Name</th>
          <th>Description</th>
          <th>Expiry Date</th>
          <th>Priority</th>
          <th>Status</th>
          <th>Notes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of tasks">
          <td>{{ task.taskName }}</td>
          <td>{{ task.taskDescription }}</td>
          <td>{{ task.taskExpiryDate | date: 'dd/MM/yyyy' }}</td>
          <td>
            <span class="priority-badge priority-{{ task.priority }}">
              {{ task.priority | titlecase }}
            </span>
          </td>
          <td>
            <span class="status-badge status-{{ task.status.toLowerCase().replace(' ', '-') }}">
              {{ task.status }}
            </span>
          </td>
          <td>{{ task.notes }}</td>
          <td class="actions">
            <button *ngIf="task.status !== TaskStatus.COMPLETED" (click)="editTask(task)" class="btn btn-edit">Edit</button>
            <button *ngIf="task.status !== TaskStatus.COMPLETED" (click)="deleteTask(task.id!)" class="btn btn-delete">Delete</button>
            <span *ngIf="task.status === TaskStatus.COMPLETED" class="completed-label">Task Completed</span>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="tasks.length === 0" class="no-tasks">
      <p>No tasks available. Add a new task to get started.</p>
    </div>
  </div>
</div>
